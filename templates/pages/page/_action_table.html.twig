<div class="row mb-3 mt-3">
    <div class="col-10">
        <h2>Groups</h2>
    </div>
    <div class="col-2">
        <a data-toggle="tooltip"
           data-placement="bottom"
           title="New Group"
           class="btn btn-primary mt-2 mr-2 float-right "
           href="{{ path('action_group_new', {'resource': page.id, 'project': page.project.id}) }}">
            <i class="fa fa-plus-square"></i>
        </a>
    </div>
</div>

<table class="table mb-4">
    {% for id, group in page.actions %}
        <tr class="table-secondary">
            <td>
                <div class="row">
                    <div class="col-10">
                        <p class="mb-0 mt-1">
                            <a href="{{ path('action_group_edit', {'project': page.project.id, 'resource': page.id, 'group': group.id}) }}">{{ group.name }}</a>
                        </p>
                    </div>
                    <div class="col-2">
                <div class="dropdown float-right"
                     data-toggle="tooltip"
                     data-placement="left"
                     title="Add Action">
                    <button class="btn btn-secondary dropdown-toggle"
                            type="button" id="add-action-{{ id }}" data-toggle="dropdown"
                            aria-haspopup="true" aria-expanded="false">
                        <i class="fa fa-plus-square"></i>
                    </button>
                    <div class="dropdown-menu dropdown-menu-right" aria-labelledby="add-action-{{ id }}">
                        {% for type, class in actions %}
                            <a class="dropdown-item"
                               href="{{ path('action_new', {'project': page.project.id, 'resource': page.id, 'group': group.id, 'type': type}) }}">{{ type|capitalize }}</a>
                        {% endfor %}
                    </div>
                </div>
                    </div>
                </div>
            </td>
        </tr>

        <tr>
            <td class="p-0 bt-0">
                {% for action in group.actions %}
                    <div class="row">
                        <div class="col-1"></div>
                        <div class="col-11">
                            {% if action is instanceof('\\App\\Entity\\Action\\TestAction') %}
                                <table class="table mt-3 mb-0">
                                    <thead>
                                    <tr>
                                        <td colspan="3">
                                            <a href="{{ path('test_edit', {
                                                'project': page.project.id,
                                                'resource': page.id,
                                                'group': group.id,
                                                'action': action.id
                                            }) }}"><span>Test suite</span></a>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>Snapshot</td>
                                        <td colspan="2">Result</td>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    {% for result in action.results %}
                                        <tr>
                                            <td>
                                                <a href="{{ path('page_snapshot_show', {'project': result.snapshot.page.project.id, 'page': result.snapshot.page.id, 'snapshot': result.snapshot.id}) }}">{{ result.snapshot.timestamp|date(datetime_format()) }}</a>
                                            </td>
                                            <td>
                                                -
                                            </td>
                                            <td>
                                                <div class="float-right">
                                                    {{ include('components/passed-indicator.html.twig', {'passed': result.passed}) }}
                                                </div>
                                            </td>
                                        </tr>
                                    {% endfor %}
                                    </tbody>
                                </table>
                            {% endif %}
                        </div>
                    </div>
                {% endfor %}
            </td>
        </tr>
    {% endfor %}
</table>
